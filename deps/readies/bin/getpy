#!/bin/bash

show_if_error() {
	{ "${@:1}"; } > /tmp/py.log  2>&1
	[ $? != 0 ] && cat /tmp/py.log
	rm -f /tmp/py.log
}

if [ ! -z $(command -v python) ]; then
	[ "$(python --version 2>&1 | cut -d" " -f2 | cut -d. -f1)" = "3" ] && exit 0
fi

[ ! -z $(command -v python3) ] && exit 0

if [ ! -z $(command -v apt-get) ]; then
	show_if_error apt-get -qq update
	show_if_error apt-get -qq install -y python3
elif [ ! -z $(command -v dnf) ]; then
	show_if_error dnf install -y python3
elif [ ! -z $(command -v yum) ]; then
	show_if_error yum install -y epel-release
	show_if_error yum install -y python36
elif [ ! -z $(command -v apk) ]; then
	show_if_error apk update
	show_if_error apk add python3
elif [ ! -z $(command -v brew) ]; then
	show_if_error brew install python3
fi

if [ -z $(command -v python3) ]; then
	>&2 echo "Cannot install Python3. Aborting."
	exit 1
fi
