# This docker-compose file exists purely to make building within a docker, on a
# per-platform basis easier. Each target service builds a docker on the target platform, using the
# existing Dockerfile in this folder. Builds are run via the command below.
# If you'd like to build a specific OS target (i.e. bionic) add the target to the command:
#
# examples:
#   docker-compose build --parallel
#   docker-compose build bionic
#   docker-compose build --parallel bionic xenial
---

version: "3.8"
services:

  bionic:
    image: ${DOCKER_ORG:-redislabs}/redisai:${VERSION:-edge}-${DOCKER_ARCH:-x64}-${VARIANT:-cpu}-bionic
    build:
      context: ../../../
      dockerfile: ${DOCKERFILE_NAME:-Dockerfile}
      args:
        OSNICK: bionic
        REDIS_VERSION: ${REDIS_VERSION}
        ARCH: ${DOCKER_ARCH:-x64}
        VARIANT: ${VARIANT:-cpu}

  xenial:
    image: ${DOCKER_ORG:-redislabs}/redisai:${VERSION:-edge}-${DOCKER_ARCH:-x64}-${VARIANT:-cpu}-xenial
    build:
      context: ../../../
      dockerfile: ${DOCKERFILE_NAME:-Dockerfile}
      args:
        OSNICK: xenial
        REDIS_VERSION: ${REDIS_VERSION}
        ARCH: ${DOCKER_ARCH:-x64}
        VARIANT: ${VARIANT:-cpu}

  focal:
    image: ${DOCKER_ORG:-redislabs}/redisai:${VERSION:-edge}-${DOCKER_ARCH:-x64}-${VARIANT:-cpu}-focal
    build:
      context: ../../../
      dockerfile: ${DOCKERFILE_NAME:-Dockerfile}
      args:
        OSNICK: focal
        REDIS_VERSION: ${REDIS_VERSION}
        ARCH: ${DOCKER_ARCH:-x64}
        VARIANT: ${VARIANT:-cpu}

  centos7:
    image: ${DOCKER_ORG:-redislabs}/redisai:${VERSION:-edge}-${DOCKER_ARCH:-x64}-${VARIANT:-cpu}-centos7
    build:
      context: ../../../
      dockerfile: ${DOCKERFILE_NAME:-Dockerfile}
      args:
        OSNICK: centos7
        REDIS_VERSION: ${REDIS_VERSION}
        ARCH: ${DOCKER_ARCH:-x64}
        VARIANT: ${VARIANT:-cpu}

  buster:
    image: ${DOCKER_ORG:-redislabs}/redisai:${VERSION:-edge}-${DOCKER_ARCH:-x64}-${VARIANT:-cpu}-buster
    build:
      context: ../../../
      dockerfile: ${DOCKERFILE_NAME:-Dockerfile}
      args:
        OSNICK: buster
        REDIS_VERSION: ${REDIS_VERSION}
        ARCH: ${DOCKER_ARCH:-x64}
        VARIANT: ${VARIANT:-cpu}
